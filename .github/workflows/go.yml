# This workflow will build a golang project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go

name: Go

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  build_type: Release
  release_name: build_${{github.run_number}}

jobs:
  format:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.22'
    - name: Install gofumpt
      run: go install mvdan.cc/gofumpt@latest
    - name: Check formating
      run: gofumpt -d ./
  
  test:
    needs: format
    strategy:
      matrix:
        go: ['1.22', '1.25']
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: ${{matrix.go}}
    - name: Test
      run: go test -v ./...
      
  build:
    needs: test
    strategy:
      matrix:
        os: [ubuntu-24.04]
        platform: [32, 64]
    runs-on: ${{matrix.os}}
    steps:
    - uses: actions/checkout@v4
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.22'
    - name: Build
      run: go build -v ./...
    - name: Build Artifact
      run: go build -v .
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: dreamdump-${{env.release_name}}_${{matrix.os}}_${{matrix.platform}}
        path: ./dreamdump
